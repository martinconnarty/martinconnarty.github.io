<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTPS Multi-Port Timing Checker</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; }
        input { width: 200px; padding: 8px; margin: 5px; }
        button { padding: 12px 24px; background: #28a745; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #218838; }
        .result { margin: 20px 0; padding: 15px; border-radius: 6px; }
        .success { background: #d4edda; border-left: 5px solid #28a745; }
        .error { background: #f8d7da; border-left: 5px solid #dc3545; color: #721c24; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; font-weight: 600; }
        .fast-success { background: #c3e6cb !important; color: #155724; font-weight: bold; }
        .summary { font-size: 1.2em; padding: 15px; border-radius: 6px; margin-top: 20px; }
        .ports-input { background: #e9ecef; padding: 10px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>HTTPS Multi-Port Timing Checker</h1>
    <p>Enter local IP and comma-separated ports (default: 80,443,8008,8006,8080,8443). Shows only ports responding in &lt; 0.5s (SUCCESS).</p>
    
    <div>
        <input type="text" id="host" placeholder="192.168.1.100" value="192.168.1.100">
        <input type="text" id="ports" placeholder="80,443,8008,8006,8080,8443" value="80,443,8008,8006,8080,8443">
        <button onclick="runTests()">Scan Ports</button>
    </div>
    
    <div id="results"></div>

    <script>
        const TIMEOUT = 2000; // 2s timeout
        const SUCCESS_THRESHOLD = 500; // 0.5s

        async function runTests() {
            const host = document.getElementById('host').value.trim();
            const portsInput = document.getElementById('ports').value.trim();
            const ports = portsInput ? portsInput.split(',').map(p => p.trim()).filter(p => p) : [];
            
            if (!host || ports.length === 0) {
                alert('Please enter host and ports');
                return;
            }

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result success">üîÑ Scanning all ports...</div>';

            const allTests = ports.map(port => testPort(host, parseInt(port)));
            const results = await Promise.allSettled(allTests);
            
            displayResults(host, ports, results);
        }

        async function testPort(host, port) {
            const target = `https://${host}:${port}`;
            const start = performance.now();
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), TIMEOUT);
                
                const response = await fetch(target, {
                    method: 'HEAD',
                    signal: controller.signal,
                    cache: 'no-cache',
                    keepalive: true
                });
                
                clearTimeout(timeoutId);
                const end = performance.now();
                const time = end - start;
                const isFastSuccess = time < SUCCESS_THRESHOLD;
                
                return {
                    port,
                    time: time.toFixed(1),
                    status: response.status,
                    success: true,
                    fastSuccess: isFastSuccess,
                    method: 'Fetch HEAD'
                };
            } catch (e) {
                const end = performance.now();
                return {
                    port,
                    time: (end - start).toFixed(1),
                    error: e.name === 'AbortError' ? 'Timeout' : e.message,
                    success: false,
                    fastSuccess: false
                };
            }
        }

        function displayResults(host, ports, settledResults) {
            const resultsDiv = document.getElementById('results');
            const fastSuccesses = [];
            const allResults = [];

            settledResults.forEach(result => {
                if (result.status === 'fulfilled') {
                    allResults.push(result.value);
                    if (result.value.fastSuccess) {
                        fastSuccesses.push(result.value);
                    }
                }
            });

            let html = `<div class="ports-input"><strong>Tested:</strong> ${host}:${ports.join(', ')}</div>`;

            if (fastSuccesses.length > 0) {
                html += `<h3>‚úÖ FAST SUCCESS (<0.5s) - ${fastSuccesses.length}/${ports.length} ports</h3>`;
                html += '<table><tr><th>Port</th><th>Time</th><th>Status</th><th>Method</th></tr>';
                fastSuccesses.forEach(r => {
                    html += `<tr class="fast-success">
                        <td><strong>${r.port}</strong></td>
                        <td>${r.time}ms ‚ö°</td>
                        <td>${r.status || 'OK'}</td>
                        <td>${r.method}</td>
                    </tr>`;
                });
                html += '</table>';
            } else {
                html += '<div class="result error">‚ùå No ports responded in under 0.5s</div>';
            }

            const summaryClass = fastSuccesses.length > 0 ? 'success' : 'error';
            html += `<div class="summary ${summaryClass}">
                ${fastSuccesses.length > 0 ? 'üéâ LIVE PORTS FOUND' : 'üò¥ NO FAST RESPONDERS'}
                <br><small>${fastSuccesses.length}/${ports.length} ports succeeded (<500ms)</small>
            </div>`;

            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
